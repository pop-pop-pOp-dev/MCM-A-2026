# ACM Battery Simulation Configuration (YAML)
# All parameters are centralized here for reproducibility.

battery_params:
  # Electrical parameters
  Q_design_ah: 4.0          # Design capacity [Ah]
  V_cutoff: 3.0             # Cutoff voltage [V]

  # Thermal parameters
  m: 0.045                  # Effective mass of device [kg]
  Cp: 900.0                 # Effective heat capacity [J/(kg*K)]
  hA: 1.8                   # Lumped convection coefficient [W/K]
  T_env: 298.15             # Ambient temperature [K]

  # OCV model configuration
  ocv_model: "combined"
  # Combined model coefficients: [k0, k1, k2, k3, k4]
  ocv_coeffs: [3.1641369763126996, 0.013329434532685864, -0.9746467060946551, -0.22504836405236922, -0.024197927338674676]
  ocv_temp_ref: 298.15
  ocv_temp_coeff: -2.0e-4
  ocv_temp_quad: -1.0e-6

  # Internal resistance model parameters
  R_ref: 0.06               # Reference internal resistance [Ohm]
  T_ref: 298.15             # Reference temperature [K]
  Ea_R: 27538.0             # Arrhenius activation energy [J/mol] (Panasonic fit)
  R_gas: 8.314              # Universal gas constant [J/(mol*K)]
  r_soc_coeff: 2.5          # Low-SOC resistance rise strength [-]
  r_soc_k: 7.0              # Low-SOC exponential sharpness [-]
  r_soh_coeff: 1.0          # Resistance increase per SOH loss [-]

  # Coulombic efficiency parameters
  eta_coulomb_ref: 0.995
  eta_coulomb_temp_coeff: 0.0008

  # Degradation parameters
  k_cycle: 2.0e-6           # Cycle aging coefficient [1/(A*s)]
  k_cal: 1.2e-9             # Calendar aging coefficient [1/s]
  Ea_cal: 50000.0           # Activation energy [J/mol]
  alpha_soc: 1.2            # SOC acceleration factor [-]
  Ea_cap: 10100.0           # Capacity temperature dependence [J/mol] (Panasonic fit)

  # KiBaM parameters
  kibam_enabled: true       # Enable KiBaM recovery dynamics
  kibam_c: 0.6              # Available charge fraction [-]
  kibam_k: 3.0e-4           # Diffusion rate constant [1/s]

  # Polarization RC branch
  rc_enabled: true
  r_polar: 0.015            # Polarization resistance [Ohm]
  c_polar: 1200.0           # Polarization capacitance [F]

  # Screen parameters
  P_max_scr: 400.0          # Max screen power density [W/m^2]
  A_area: 0.0075            # Screen active area [m^2]
  gamma_scr: 1.5            # Brightness nonlinearity exponent [-]

  # CPU parameters
  P_idle: 0.6               # CPU idle power [W]
  P_little_max: 6.0         # Smartphone dataset (P_game_avg mapped to little)
  P_big_max: 15.0           # Smartphone dataset (P_peak_cpu mapped to big)
  u_thresh: 0.45            # Threshold for big cores [-]
  T_throttle: 318.15        # Throttle midpoint temperature [K] ~ 45C
  throttle_k: 0.35          # Throttle sigmoid steepness [-]

  # Macro communication states
  wifi_idle_power: 0.1      # Recommended smartphone measured idle (~0.1W)
  wifi_active_power: 1.5    # Recommended smartphone measured active (~1.2-1.8W)
  gps_on_power: 0.5         # Recommended smartphone measured GPS (~0.4-0.6W)

  # OS feedback (low power mode)
  lpm_soc_thresh: 0.2       # SOC threshold [-]
  lpm_k: 20.0               # Sigmoid steepness [-]
  lpm_min_factor: 0.7       # Minimum scaling factor [-]

  # Charging parameters
  charger_efficiency: 0.9   # Charger efficiency [-]
  v_stress_thresh: 4.1      # Voltage stress threshold [V]
  k_stress: 5.0e-10         # Voltage stress coefficient [1/s]
  beta_stress: 12.0         # Voltage stress slope [1/V]

  # Initial state
  SOC_init: 1.0
  T_init: 298.15
  SOH_init: 1.0

scenarios:
  - name: Video Streaming
    duration_s: 21600
    dt: 5
    env_temp_k: 298.15
    eta_radiation: 0.03
    brightness: {type: constant, value: 0.85}
    apl: {type: constant, value: 0.7}
    cpu_util: {type: constant, value: 0.45}
    wifi_state: {type: constant, value: 2}         # 0 off, 1 idle, 2 active
    gps_state: {type: constant, value: 1}          # 0 off, 1 on
    charger_power: {type: constant, value: 0.0}

  - name: Gaming
    duration_s: 14400
    dt: 5
    env_temp_k: 300.15
    eta_radiation: 0.03
    brightness: {type: constant, value: 0.95}
    apl: {type: constant, value: 0.8}
    cpu_util: {type: constant, value: 0.9}
    wifi_state: {type: constant, value: 1}
    gps_state: {type: constant, value: 1}
    charger_power: {type: constant, value: 0.0}

  - name: Winter Usage
    duration_s: 25200
    dt: 5
    env_temp_k: 273.15
    eta_radiation: 0.03
    brightness: {type: constant, value: 0.6}
    apl: {type: constant, value: 0.6}
    cpu_util: {type: constant, value: 0.4}
    wifi_state: {type: constant, value: 1}
    gps_state: {type: constant, value: 0}
    charger_power: {type: constant, value: 0.0}

sensitivity:
  base_scenario: "Video Streaming"
  duration_s: 28800
  dt: 10
  brightness_grid:
    type: linspace
    start: 0.2
    end: 1.0
    num: 9
  temp_grid_c:
    type: linspace
    start: -5
    end: 35
    num: 9

uncertainty:
  enabled: true
  base_scenario: "Video Streaming"
  n_samples: 50
  seed: 42
  perturb:
    hA: {std_frac: 0.1, min: 0.5, max: 3.5}
    R_ref: {std_frac: 0.1, min: 0.02, max: 0.15}
    Ea_R: {std_frac: 0.1, min: 8000, max: 40000}
    k_cycle: {std_frac: 0.2, min: 1.0e-7, max: 1.0e-5}

data_paths:
  calce_ocv_csv: datasets/calce_ocv/cs2_8_ocv_curve.csv
  nasa_random_csv: datasets/nasa_random/rw17_standard.csv
  panasonic_temp_csv: datasets/panasonic_temp/n10degC_cycle1_standard.csv
  aging_chalmers_dir: datasets/aging_chalmers
  aosp_power_profile_xml: datasets/aosp_power_profile/power_profile.xml
  phone_validation_csv: datasets/phone_validation/phone_validation_wltp.csv
  phone_validation_real_csv: datasets/phone_validation_real/phone_validation_bcm_s9_combined.csv

validation:
  enabled: true
  mode: current_profile
  current_profile_csv: datasets/phone_validation_real/phone_validation_bcm_s9_combined.csv
  use_temp_from_csv: true
  calibrate: true
  current_scale_bounds: [0.8, 1.2]
  use_soc_from_csv: true

output:
  enabled: true
  format: csv   # csv or json
  directory: outputs

solver:
  method: DOP853
  rtol: 1.0e-8
  atol: 1.0e-10
  max_step: 5.0

visualization:
  realtime: false
  interval_ms: 80
  max_points: 300
  frame_stride: 50
  save_frames: true
  show: false
